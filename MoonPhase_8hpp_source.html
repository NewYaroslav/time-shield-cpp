<!-- HTML header for doxygen 1.11.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Time Shield Library: include/time_shield/MoonPhase.hpp Source File</title>
<link rel="icon" href="icon-64x64.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
	DoxygenAwesomeDarkModeToggle.init()
	DoxygenAwesomeParagraphLink.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Time Shield Library
   </div>
   <div id="projectbrief">C++ library for working with time</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('MoonPhase_8hpp_source.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">MoonPhase.hpp</div></div>
</div><!--header-->
<div class="contents">
<a href="MoonPhase_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">// SPDX-License-Identifier: MIT</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="preprocessor">#pragma once</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="preprocessor">#ifndef _TIME_SHIELD_MOON_PHASE_HPP_INCLUDED</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="preprocessor">#define _TIME_SHIELD_MOON_PHASE_HPP_INCLUDED</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span> </div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#include &quot;<a class="code" href="date__time__conversions_8hpp.html">date_time_conversions.hpp</a>&quot;</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#include &quot;<a class="code" href="types_8hpp.html">types.hpp</a>&quot;</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span> </div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#include &lt;cstddef&gt;</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacetime__shield.html">time_shield</a> {</div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span> </div>
<div class="foldopen" id="foldopen00019" data-start="{" data-end="}">
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno"><a class="line" href="namespacetime__shield_1_1astronomy.html">   19</a></span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacetime__shield_1_1astronomy.html">astronomy</a> {</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span></div>
<div class="foldopen" id="foldopen00022" data-start="{" data-end="};">
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html">   22</a></span>    <span class="keyword">struct </span><a class="code hl_struct" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html">MoonPhaseResult</a> {</div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#a8951e27fdb33eee9dd28d4728d634eb8">   23</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#a8951e27fdb33eee9dd28d4728d634eb8">phase</a> = 0.0;              </div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#ae253f47c5b67846a3f274cecf527e65f">   24</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#ae253f47c5b67846a3f274cecf527e65f">illumination</a> = 0.0;       </div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#ab228bffaa62de41e0808ea069dd2363a">   25</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#ab228bffaa62de41e0808ea069dd2363a">age_days</a> = 0.0;           </div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#a33799b14b055d6c8e0e38360b52df878">   26</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#a33799b14b055d6c8e0e38360b52df878">distance_km</a> = 0.0;        </div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#a7b675de383072b1bedebe3bf0159bbad">   27</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#a7b675de383072b1bedebe3bf0159bbad">diameter_deg</a> = 0.0;       </div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#a293f0368555bf2e39ec792c672dd231c">   28</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#a293f0368555bf2e39ec792c672dd231c">age_deg</a> = 0.0;            </div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#aab77c808b2b2bd104293bd7808156bd6">   29</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#aab77c808b2b2bd104293bd7808156bd6">phase_angle_rad</a> = 0.0;    </div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#aa5e113195cdff17210b79cf78a87fc35">   30</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#aa5e113195cdff17210b79cf78a87fc35">phase_sin</a> = 0.0;          </div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#ab8d76a7d973ff539b60d7a0aaf5c4671">   31</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#ab8d76a7d973ff539b60d7a0aaf5c4671">phase_cos</a> = 0.0;          </div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#a152397a580e31c179e4a327a6e57d0dc">   32</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#a152397a580e31c179e4a327a6e57d0dc">sun_distance_km</a> = 0.0;</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#aefe0063683948d45ee44e7a97746e4b6">   33</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#aefe0063683948d45ee44e7a97746e4b6">sun_diameter_deg</a> = 0.0;</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>    };</div>
</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span></div>
<div class="foldopen" id="foldopen00037" data-start="{" data-end="};">
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html">   37</a></span>    <span class="keyword">struct </span><a class="code hl_struct" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html">MoonQuarterInstants</a> {</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#a356edba6d87834d2b899c9cd62b0ad7c">   38</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#a356edba6d87834d2b899c9cd62b0ad7c">previous_new_unix_s</a> = 0.0; </div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#a42529ef6435ba9498a9d0084e2a861a9">   39</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#a42529ef6435ba9498a9d0084e2a861a9">previous_first_quarter_unix_s</a> = 0.0; </div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#a4dae0578645fabc81a9fd1afb07800ec">   40</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#a4dae0578645fabc81a9fd1afb07800ec">previous_full_unix_s</a> = 0.0; </div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#ab7d1206dfddf7dca7c9d837d49049daa">   41</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#ab7d1206dfddf7dca7c9d837d49049daa">previous_last_quarter_unix_s</a> = 0.0; </div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#a74179e2125a2eef0a9f2a7d3f43f2d45">   42</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#a74179e2125a2eef0a9f2a7d3f43f2d45">next_new_unix_s</a> = 0.0; </div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#ae7de2c2e6e5ce88a993f0ca7f9428223">   43</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#ae7de2c2e6e5ce88a993f0ca7f9428223">next_first_quarter_unix_s</a> = 0.0; </div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#af08745ad437f9b22a8d2811b50383460">   44</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#af08745ad437f9b22a8d2811b50383460">next_full_unix_s</a> = 0.0; </div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno"><a class="line" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#a5708c19ab02832b8feb1995fc973e1dc">   45</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#a5708c19ab02832b8feb1995fc973e1dc">next_last_quarter_unix_s</a> = 0.0; </div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>    };</div>
</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span></div>
<div class="foldopen" id="foldopen00068" data-start="{" data-end="};">
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html">   68</a></span>    <span class="keyword">class </span><a class="code hl_class" href="classtime__shield_1_1astronomy_1_1MoonPhase.html">MoonPhase</a> {</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>    <span class="keyword">public</span>:</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a9e5093e5d7e0f613eabae913f8c83c2a">   70</a></span>        <span class="keyword">using </span><a class="code hl_typedef" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a9e5093e5d7e0f613eabae913f8c83c2a">quarters_unix_s_t</a> = std::array&lt;double, 8&gt;; </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ab0327bbd5a359bc046f92ed2b94bae54">   71</a></span>        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ab0327bbd5a359bc046f92ed2b94bae54">kDefaultQuarterWindow_s</a> = 43200.0; </div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span></div>
<div class="foldopen" id="foldopen00076" data-start="{" data-end="}">
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a510f2cd6268d99dd1a99f391893beedf">   76</a></span>        <a class="code hl_struct" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html">MoonPhaseResult</a> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a510f2cd6268d99dd1a99f391893beedf">compute</a>(<span class="keywordtype">double</span> unix_utc_s) <span class="keyword">const</span> <span class="keyword">noexcept</span> {</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>            <a class="code hl_struct" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html">MoonPhaseResult</a> out{};</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> jd = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a4ca8d9485791b7f880418b33575fe4f8">julian_day_from_unix_seconds</a>(unix_utc_s);</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span> </div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>            <span class="comment">// --- Sun position ---</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> day = jd - <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aee14e4c2513dcc7f4146d8f1fb7715ed">kEpochJd</a>;</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> N = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d29495d3fac6f768ebe1d0c6f9494d6">fix_angle</a>((360.0 / 365.2422) * day);</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> M = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d29495d3fac6f768ebe1d0c6f9494d6">fix_angle</a>(N + <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a58824eb63383bdd9353f33c860f60a47">kElonge</a> - <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a3aa8aa8604c348634e20ab4a2c44fd1b">kElongp</a>);</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span> </div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>            <span class="keywordtype">double</span> Ec = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ab3d9eaaf9491eb4d62f9d26350cbdb22">kepler</a>(M, <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a70fa6a64f283459165c67a92fd508265">kEccent</a>);</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>            Ec = std::sqrt((1.0 + <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a70fa6a64f283459165c67a92fd508265">kEccent</a>) / (1.0 - <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a70fa6a64f283459165c67a92fd508265">kEccent</a>)) * std::tan(Ec / 2.0);</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>            Ec = 2.0 * <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d4be9a42d333a53d54972970f81e0fc">rad2deg</a>(std::atan(Ec));</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> lambda_sun = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d29495d3fac6f768ebe1d0c6f9494d6">fix_angle</a>(Ec + <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a3aa8aa8604c348634e20ab4a2c44fd1b">kElongp</a>);</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span> </div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> F = ((1.0 + <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a70fa6a64f283459165c67a92fd508265">kEccent</a> * std::cos(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(Ec))) / (1.0 - <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a70fa6a64f283459165c67a92fd508265">kEccent</a> * <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a70fa6a64f283459165c67a92fd508265">kEccent</a>));</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> sun_dist = <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a30b8cb4954ccbe0fb64582538145f86d">kSunSmax</a> / F;</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> sun_ang = F * <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#adcf38c065a3433b94d56a2de617973a7">kSunAngSiz</a>;</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span> </div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>            <span class="comment">// --- Moon position ---</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> ml = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d29495d3fac6f768ebe1d0c6f9494d6">fix_angle</a>(13.1763966 * day + <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a25530dee9254fab236da31360b6e009b">kMmLong</a>);</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> MM = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d29495d3fac6f768ebe1d0c6f9494d6">fix_angle</a>(ml - 0.1114041 * day - <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a660dc67f4d519cd1a637a51c3b3a37f8">kMmLongp</a>);</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span> </div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> Ev = 1.2739 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(2.0 * (ml - lambda_sun) - MM));</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> Ae = 0.1858 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(M));</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> A3 = 0.37   * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(M));</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> MmP = MM + Ev - Ae - A3;</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span> </div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> mEc = 6.2886 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(MmP));</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> A4  = 0.214  * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(2.0 * MmP));</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> lP  = ml + Ev + mEc - Ae + A4;</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span> </div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> V   = 0.6583 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(2.0 * (lP - lambda_sun)));</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> lPP = lP + V;</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span> </div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>            <span class="comment">// --- Phase ---</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> moon_age_deg_wrapped = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d29495d3fac6f768ebe1d0c6f9494d6">fix_angle</a>(lPP - lambda_sun);</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> moon_age_rad = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(moon_age_deg_wrapped);</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> illum = (1.0 - std::cos(moon_age_rad)) / 2.0;</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span> </div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> moon_dist = (<a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a644a32493c3059111bf2e59ba95c0a4a">kMsMax</a> * (1.0 - <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d3bd175ba3b49a3998efae951169e3a">kMecc</a> * <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d3bd175ba3b49a3998efae951169e3a">kMecc</a>))</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>                / (1.0 + <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d3bd175ba3b49a3998efae951169e3a">kMecc</a> * std::cos(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(MmP + mEc)));</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span> </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> moon_dfrac = moon_dist / <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a644a32493c3059111bf2e59ba95c0a4a">kMsMax</a>;</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> moon_ang = <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ab68f9bf10252c729eb15398425adbf6e">kMAngSiz</a> / moon_dfrac;</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span> </div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>            out.phase = moon_age_deg_wrapped / 360.0;</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>            out.illumination = illum;</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>            out.age_days = <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a1149b5dacf88afce4526fca7d6c2204f">kSynMonth</a> * out.phase;</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>            out.distance_km = moon_dist;</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>            out.diameter_deg = moon_ang;</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>            out.age_deg = moon_age_deg_wrapped;</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>            out.phase_angle_rad = moon_age_rad;</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>            out.phase_sin = std::sin(moon_age_rad);</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>            out.phase_cos = std::cos(moon_age_rad);</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>            out.sun_distance_km = sun_dist;</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>            out.sun_diameter_deg = sun_ang;</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>            <span class="keywordflow">return</span> out;</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>        }</div>
</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span></div>
<div class="foldopen" id="foldopen00138" data-start="{" data-end="}">
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a95bdc8ef4de8e54a4d91d226a8d6b31b">  138</a></span>        <span class="keywordtype">double</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a95bdc8ef4de8e54a4d91d226a8d6b31b">compute_phase</a>(<span class="keywordtype">double</span> unix_utc_s) <span class="keyword">const</span> <span class="keyword">noexcept</span> {</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a510f2cd6268d99dd1a99f391893beedf">compute</a>(unix_utc_s).<a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#a8951e27fdb33eee9dd28d4728d634eb8">phase</a>;</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>        }</div>
</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span></div>
<div class="foldopen" id="foldopen00145" data-start="{" data-end="}">
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8ac97be03c5d31fb2fa832a1ee17ed38">  145</a></span>        <a class="code hl_typedef" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a9e5093e5d7e0f613eabae913f8c83c2a">quarters_unix_s_t</a> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8ac97be03c5d31fb2fa832a1ee17ed38">quarter_times_unix</a>(<span class="keywordtype">double</span> unix_utc_s) <span class="keyword">const</span> <span class="keyword">noexcept</span> {</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> sdate = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a4ca8d9485791b7f880418b33575fe4f8">julian_day_from_unix_seconds</a>(unix_utc_s);</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>            <span class="keywordtype">double</span> adate = sdate - 45.0;</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span> </div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> ats = unix_utc_s - 86400.0 * 45.0;</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>            <span class="keyword">const</span> <span class="keywordtype">int</span> yy = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ada6d22fcf95905617e00ab6402e40361">year_from_unix_seconds</a>(ats);</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>            <span class="keyword">const</span> <span class="keywordtype">int</span> mm = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ac78daeeb9218e164893b03fdf6d78beb">month_from_unix_seconds</a>(ats);</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span> </div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>            <span class="comment">// IMPORTANT: use floating division</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>            <span class="keywordtype">double</span> k1 = std::floor((yy + ((mm - 1) * (1.0 / 12.0)) - 1900.0) * 12.3685);</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>            <span class="keywordtype">double</span> k2 = 0.0;</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span> </div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>            <span class="keywordtype">double</span> nt1 = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a1a522c5b8d60030b12ffbaaf4d760873">mean_phase_jd</a>(adate, k1);</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>            adate = nt1;</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span> </div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>            <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>                adate += <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a1149b5dacf88afce4526fca7d6c2204f">kSynMonth</a>;</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>                k2 = k1 + 1.0;</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span> </div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>                <span class="keywordtype">double</span> nt2 = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a1a522c5b8d60030b12ffbaaf4d760873">mean_phase_jd</a>(adate, k2);</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>                <span class="keywordflow">if</span> (std::abs(nt2 - sdate) &lt; 0.75) {</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>                    nt2 = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#af8af02d0a8697ac2d40b6b40190f7fa9">true_phase_jd</a>(k2, 0.0); <span class="comment">// new moon correction</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>                }</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span> </div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>                <span class="keywordflow">if</span> (nt1 &lt;= sdate &amp;&amp; nt2 &gt; sdate) {</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>                }</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span> </div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>                nt1 = nt2;</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>                k1 = k2;</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>            }</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span> </div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> dates_jd[8] = {</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>                <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#af8af02d0a8697ac2d40b6b40190f7fa9">true_phase_jd</a>(k1, 0.0),</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>                <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#af8af02d0a8697ac2d40b6b40190f7fa9">true_phase_jd</a>(k1, 0.25),</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>                <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#af8af02d0a8697ac2d40b6b40190f7fa9">true_phase_jd</a>(k1, 0.5),</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>                <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#af8af02d0a8697ac2d40b6b40190f7fa9">true_phase_jd</a>(k1, 0.75),</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>                <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#af8af02d0a8697ac2d40b6b40190f7fa9">true_phase_jd</a>(k2, 0.0),</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>                <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#af8af02d0a8697ac2d40b6b40190f7fa9">true_phase_jd</a>(k2, 0.25),</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>                <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#af8af02d0a8697ac2d40b6b40190f7fa9">true_phase_jd</a>(k2, 0.5),</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>                <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#af8af02d0a8697ac2d40b6b40190f7fa9">true_phase_jd</a>(k2, 0.75)</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>            };</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span> </div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>            <a class="code hl_typedef" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a9e5093e5d7e0f613eabae913f8c83c2a">quarters_unix_s_t</a> out{};</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>            <span class="keywordflow">for</span> (std::size_t i = 0; i &lt; 8; ++i) {</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>                out[i] = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a6a30cb01a518020c1c03b8db1d93dd64">jd_to_unix_seconds</a>(dates_jd[i]);</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>            }</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>            <span class="keywordflow">return</span> out;</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>        }</div>
</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span></div>
<div class="foldopen" id="foldopen00198" data-start="{" data-end="}">
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a85cf6d6f58cfc24c6176b5d963f64f25">  198</a></span>        <a class="code hl_typedef" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a9e5093e5d7e0f613eabae913f8c83c2a">quarters_unix_s_t</a> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a85cf6d6f58cfc24c6176b5d963f64f25">quarter_times</a>(<span class="keywordtype">double</span> unix_utc_s) <span class="keyword">const</span> <span class="keyword">noexcept</span> {</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8ac97be03c5d31fb2fa832a1ee17ed38">quarter_times_unix</a>(unix_utc_s);</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>        }</div>
</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span></div>
<div class="foldopen" id="foldopen00205" data-start="{" data-end="}">
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a596b898f56948e52343ffa94aa547d19">  205</a></span>        <a class="code hl_struct" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html">MoonQuarterInstants</a> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a596b898f56948e52343ffa94aa547d19">quarter_instants_unix</a>(<span class="keywordtype">double</span> unix_utc_s) <span class="keyword">const</span> <span class="keyword">noexcept</span> {</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>            <span class="keyword">const</span> <span class="keyword">auto</span> quarters = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8ac97be03c5d31fb2fa832a1ee17ed38">quarter_times_unix</a>(unix_utc_s);</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>            <a class="code hl_struct" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html">MoonQuarterInstants</a> out{};</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>            out.<a class="code hl_variable" href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#a356edba6d87834d2b899c9cd62b0ad7c">previous_new_unix_s</a> = quarters[0];</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>            out.previous_first_quarter_unix_s = quarters[1];</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>            out.previous_full_unix_s = quarters[2];</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>            out.previous_last_quarter_unix_s = quarters[3];</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>            out.next_new_unix_s = quarters[4];</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>            out.next_first_quarter_unix_s = quarters[5];</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>            out.next_full_unix_s = quarters[6];</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>            out.next_last_quarter_unix_s = quarters[7];</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>            <span class="keywordflow">return</span> out;</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>        }</div>
</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span></div>
<div class="foldopen" id="foldopen00223" data-start="{" data-end="}">
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a1200e60d09e8c6c3e1a4a4bce66db93e">  223</a></span>        <span class="keywordtype">bool</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a1200e60d09e8c6c3e1a4a4bce66db93e">is_new_moon_window</a>(<span class="keywordtype">double</span> unix_utc_s, <span class="keywordtype">double</span> window_seconds = <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ab0327bbd5a359bc046f92ed2b94bae54">kDefaultQuarterWindow_s</a>) <span class="keyword">const</span> <span class="keyword">noexcept</span> {</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>            <span class="keyword">const</span> <span class="keyword">auto</span> instants = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a596b898f56948e52343ffa94aa547d19">quarter_instants_unix</a>(unix_utc_s);</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a267e3e5f3d326a6f875ab807ba7552ca">is_within_window</a>(unix_utc_s, instants.previous_new_unix_s, instants.next_new_unix_s, window_seconds);</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>        }</div>
</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span></div>
<div class="foldopen" id="foldopen00232" data-start="{" data-end="}">
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#af2516e7561063f516f966111b70ac810">  232</a></span>        <span class="keywordtype">bool</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#af2516e7561063f516f966111b70ac810">is_full_moon_window</a>(<span class="keywordtype">double</span> unix_utc_s, <span class="keywordtype">double</span> window_seconds = <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ab0327bbd5a359bc046f92ed2b94bae54">kDefaultQuarterWindow_s</a>) <span class="keyword">const</span> <span class="keyword">noexcept</span> {</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>            <span class="keyword">const</span> <span class="keyword">auto</span> instants = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a596b898f56948e52343ffa94aa547d19">quarter_instants_unix</a>(unix_utc_s);</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a267e3e5f3d326a6f875ab807ba7552ca">is_within_window</a>(unix_utc_s, instants.previous_full_unix_s, instants.next_full_unix_s, window_seconds);</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>        }</div>
</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span></div>
<div class="foldopen" id="foldopen00241" data-start="{" data-end="}">
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a4a7e8bae14e8b7a60204d48e2ab16d34">  241</a></span>        <span class="keywordtype">bool</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a4a7e8bae14e8b7a60204d48e2ab16d34">is_first_quarter_window</a>(<span class="keywordtype">double</span> unix_utc_s, <span class="keywordtype">double</span> window_seconds = <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ab0327bbd5a359bc046f92ed2b94bae54">kDefaultQuarterWindow_s</a>) <span class="keyword">const</span> <span class="keyword">noexcept</span> {</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>            <span class="keyword">const</span> <span class="keyword">auto</span> instants = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a596b898f56948e52343ffa94aa547d19">quarter_instants_unix</a>(unix_utc_s);</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a267e3e5f3d326a6f875ab807ba7552ca">is_within_window</a>(unix_utc_s, instants.previous_first_quarter_unix_s, instants.next_first_quarter_unix_s, window_seconds);</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>        }</div>
</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span></div>
<div class="foldopen" id="foldopen00250" data-start="{" data-end="}">
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#af088de31fdc1edadfb2d0f5631e57782">  250</a></span>        <span class="keywordtype">bool</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#af088de31fdc1edadfb2d0f5631e57782">is_last_quarter_window</a>(<span class="keywordtype">double</span> unix_utc_s, <span class="keywordtype">double</span> window_seconds = <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ab0327bbd5a359bc046f92ed2b94bae54">kDefaultQuarterWindow_s</a>) <span class="keyword">const</span> <span class="keyword">noexcept</span> {</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>            <span class="keyword">const</span> <span class="keyword">auto</span> instants = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a596b898f56948e52343ffa94aa547d19">quarter_instants_unix</a>(unix_utc_s);</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a267e3e5f3d326a6f875ab807ba7552ca">is_within_window</a>(unix_utc_s, instants.previous_last_quarter_unix_s, instants.next_last_quarter_unix_s, window_seconds);</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>        }</div>
</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span> </div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>    <span class="keyword">private</span>:</div>
<div class="foldopen" id="foldopen00256" data-start="{" data-end="}">
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a4ca8d9485791b7f880418b33575fe4f8">  256</a></span>        <span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a4ca8d9485791b7f880418b33575fe4f8">julian_day_from_unix_seconds</a>(<span class="keywordtype">double</span> unix_utc_s) <span class="keyword">noexcept</span> {</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>            <span class="keywordflow">return</span> 2440587.5 + unix_utc_s / 86400.0;</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>        }</div>
</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span> </div>
<div class="foldopen" id="foldopen00260" data-start="{" data-end="}">
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ada6d22fcf95905617e00ab6402e40361">  260</a></span>        <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ada6d22fcf95905617e00ab6402e40361">year_from_unix_seconds</a>(<span class="keywordtype">double</span> unix_utc_s) <span class="keyword">noexcept</span> {</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>            <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code hl_function" href="group__time__conversions.html#gae79100051ffcecb99ee8051e76133fac">year_of&lt;year_t&gt;</a>(<span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="group__time__types.html#ga183c70b9c541a395d47690a82cdad282">ts_t</a><span class="keyword">&gt;</span>(unix_utc_s)));</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>        }</div>
</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span> </div>
<div class="foldopen" id="foldopen00264" data-start="{" data-end="}">
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ac78daeeb9218e164893b03fdf6d78beb">  264</a></span>        <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ac78daeeb9218e164893b03fdf6d78beb">month_from_unix_seconds</a>(<span class="keywordtype">double</span> unix_utc_s) <span class="keyword">noexcept</span> {</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>            <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code hl_function" href="group__time__structures.html#ga2673575f5f1962b618dbdf1a1c596914">month_of_year&lt;int&gt;</a>(<span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="group__time__types.html#ga183c70b9c541a395d47690a82cdad282">ts_t</a><span class="keyword">&gt;</span>(unix_utc_s)));</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>        }</div>
</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span> </div>
<div class="foldopen" id="foldopen00268" data-start="{" data-end="}">
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a6a30cb01a518020c1c03b8db1d93dd64">  268</a></span>        <span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a6a30cb01a518020c1c03b8db1d93dd64">jd_to_unix_seconds</a>(<span class="keywordtype">double</span> julian_day) <span class="keyword">noexcept</span> {</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>            <span class="keywordflow">return</span> (julian_day - 2440587.5) * 86400.0;</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>        }</div>
</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span> </div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>        <span class="comment">// --- Constants (1980 January 0.0) ---</span></div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aee14e4c2513dcc7f4146d8f1fb7715ed">  273</a></span>        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aee14e4c2513dcc7f4146d8f1fb7715ed">kEpochJd</a>   = 2444238.5;</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span> </div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a58824eb63383bdd9353f33c860f60a47">  275</a></span>        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a58824eb63383bdd9353f33c860f60a47">kElonge</a>   = 278.833540;</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a3aa8aa8604c348634e20ab4a2c44fd1b">  276</a></span>        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a3aa8aa8604c348634e20ab4a2c44fd1b">kElongp</a>   = 282.596403;</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a70fa6a64f283459165c67a92fd508265">  277</a></span>        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a70fa6a64f283459165c67a92fd508265">kEccent</a>   = 0.016718;</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a30b8cb4954ccbe0fb64582538145f86d">  278</a></span>        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a30b8cb4954ccbe0fb64582538145f86d">kSunSmax</a>  = 1.495985e8; <span class="comment">// km</span></div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#adcf38c065a3433b94d56a2de617973a7">  279</a></span>        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#adcf38c065a3433b94d56a2de617973a7">kSunAngSiz</a>= 0.533128;   <span class="comment">// deg</span></div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span> </div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a25530dee9254fab236da31360b6e009b">  281</a></span>        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a25530dee9254fab236da31360b6e009b">kMmLong</a>   = 64.975464;</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a660dc67f4d519cd1a637a51c3b3a37f8">  282</a></span>        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a660dc67f4d519cd1a637a51c3b3a37f8">kMmLongp</a>  = 349.383063;</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a23981d3f5955b843b4e533fac4278428">  283</a></span>        [[maybe_unused]] <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a23981d3f5955b843b4e533fac4278428">kMNode</a>    = 151.950429;</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a0dadf0452c83ed1d4c3b25a045b3b528">  284</a></span>        [[maybe_unused]] <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a0dadf0452c83ed1d4c3b25a045b3b528">kMInc</a>     = 5.145396;</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d3bd175ba3b49a3998efae951169e3a">  285</a></span>        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d3bd175ba3b49a3998efae951169e3a">kMecc</a>     = 0.054900;</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ab68f9bf10252c729eb15398425adbf6e">  286</a></span>        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ab68f9bf10252c729eb15398425adbf6e">kMAngSiz</a>  = 0.5181;     <span class="comment">// deg</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a644a32493c3059111bf2e59ba95c0a4a">  287</a></span>        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a644a32493c3059111bf2e59ba95c0a4a">kMsMax</a>    = 384401.0;   <span class="comment">// km</span></div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a84e68b0e7b5aec034f887eb28bdaaae1">  288</a></span>        [[maybe_unused]] <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a84e68b0e7b5aec034f887eb28bdaaae1">kMParallax</a>= 0.9507;     <span class="comment">// deg</span></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a1149b5dacf88afce4526fca7d6c2204f">  289</a></span>        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a1149b5dacf88afce4526fca7d6c2204f">kSynMonth</a> = 29.53058868;</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span> </div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a44c3905d162ed09fcb8bb608503659e1">  291</a></span>        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a44c3905d162ed09fcb8bb608503659e1">kPi</a> = 3.14159265358979323846;</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span> </div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">  293</a></span>        <span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(<span class="keywordtype">double</span> deg) <span class="keyword">noexcept</span> { <span class="keywordflow">return</span> deg * (<a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a44c3905d162ed09fcb8bb608503659e1">kPi</a> / 180.0); }</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d4be9a42d333a53d54972970f81e0fc">  294</a></span>        <span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d4be9a42d333a53d54972970f81e0fc">rad2deg</a>(<span class="keywordtype">double</span> rad) <span class="keyword">noexcept</span> { <span class="keywordflow">return</span> rad * (180.0 / <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a44c3905d162ed09fcb8bb608503659e1">kPi</a>); }</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span> </div>
<div class="foldopen" id="foldopen00296" data-start="{" data-end="}">
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d29495d3fac6f768ebe1d0c6f9494d6">  296</a></span>        <span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d29495d3fac6f768ebe1d0c6f9494d6">fix_angle</a>(<span class="keywordtype">double</span> a) <span class="keyword">noexcept</span> {</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>            a = std::fmod(a, 360.0);</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>            <span class="keywordflow">if</span> (a &lt; 0.0) a += 360.0;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>            <span class="keywordflow">return</span> a;</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>        }</div>
</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span> </div>
<div class="foldopen" id="foldopen00302" data-start="{" data-end="}">
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ab3d9eaaf9491eb4d62f9d26350cbdb22">  302</a></span>        <span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ab3d9eaaf9491eb4d62f9d26350cbdb22">kepler</a>(<span class="keywordtype">double</span> m_deg, <span class="keywordtype">double</span> ecc) <span class="keyword">noexcept</span> {</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>            <span class="keyword">constexpr</span> <span class="keywordtype">double</span> eps = 1e-6;</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> m = <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(m_deg);</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>            <span class="keywordtype">double</span> e = m;</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 50; ++i) {</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>                <span class="keyword">const</span> <span class="keywordtype">double</span> delta = e - ecc * std::sin(e) - m;</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>                e -= delta / (1.0 - ecc * std::cos(e));</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>                <span class="keywordflow">if</span> (std::abs(delta) &lt;= eps) <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>            }</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>            <span class="keywordflow">return</span> e;</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>        }</div>
</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span> </div>
<div class="foldopen" id="foldopen00314" data-start="{" data-end="}">
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a1a522c5b8d60030b12ffbaaf4d760873">  314</a></span>        <span class="keywordtype">double</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a1a522c5b8d60030b12ffbaaf4d760873">mean_phase_jd</a>(<span class="keywordtype">double</span> julian_day, <span class="keywordtype">double</span> lunation_index) <span class="keyword">const</span> <span class="keyword">noexcept</span> {</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> jt = (julian_day - 2415020.0) / 36525.0;</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> t2 = jt * jt;</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> t3 = t2 * jt;</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span> </div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>            <span class="keywordflow">return</span> 2415020.75933 + <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a1149b5dacf88afce4526fca7d6c2204f">kSynMonth</a> * lunation_index</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>                + 0.0001178 * t2</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>                - 0.000000155 * t3</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>                + 0.00033 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(166.56 + 132.87 * jt - 0.009173 * t2));</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>        }</div>
</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span> </div>
<div class="foldopen" id="foldopen00325" data-start="{" data-end="}">
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#af8af02d0a8697ac2d40b6b40190f7fa9">  325</a></span>        <span class="keywordtype">double</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#af8af02d0a8697ac2d40b6b40190f7fa9">true_phase_jd</a>(<span class="keywordtype">double</span> lunation_index, <span class="keywordtype">double</span> phase_fraction) <span class="keyword">const</span> <span class="keyword">noexcept</span> {</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>            <span class="comment">// This algorithm is designed for phase_fraction in {0, 0.25, 0.5, 0.75}.</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> kx = lunation_index + phase_fraction;</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> t  = kx / 1236.85;</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> t2 = t * t;</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> t3 = t2 * t;</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span> </div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>            <span class="keywordtype">double</span> pt = 2415020.75933</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>                + <a class="code hl_variable" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a1149b5dacf88afce4526fca7d6c2204f">kSynMonth</a> * kx</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>                + 0.0001178 * t2</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>                - 0.000000155 * t3</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>                + 0.00033 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(166.56 + 132.87 * t - 0.009173 * t2));</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span> </div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> m      = 359.2242 + 29.10535608  * kx - 0.0000333 * t2 - 0.00000347 * t3;</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> mprime = 306.0253 + 385.81691806 * kx + 0.0107306  * t2 + 0.00001236 * t3;</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> f      = 21.2964  + 390.67050646 * kx - 0.0016528  * t2 - 0.00000239 * t3;</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span> </div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>            <span class="comment">// Corrections (same structure as common ports of moontool)</span></div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>            <span class="keywordflow">if</span> (phase_fraction &lt; 0.01 || std::abs(phase_fraction - 0.5) &lt; 0.01) {</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>                pt += (0.1734 - 0.000393 * t) * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(m))</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>                    + 0.0021 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(2 * m))</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>                    - 0.4068 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(mprime))</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>                    + 0.0161 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(2 * mprime))</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>                    - 0.0004 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(3 * mprime))</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>                    + 0.0104 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(2 * f))</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>                    - 0.0051 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(m + mprime))</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>                    - 0.0074 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(m - mprime))</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>                    + 0.0004 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(2 * f + m))</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>                    - 0.0004 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(2 * f - m))</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>                    - 0.0006 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(2 * f + mprime))</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>                    + 0.0010 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(2 * f - mprime))</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>                    + 0.0005 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(m + 2 * mprime));</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>                <span class="keywordflow">return</span> pt;</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>            }</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span> </div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>            <span class="keywordflow">if</span> (std::abs(phase_fraction - 0.25) &lt; 0.01 || std::abs(phase_fraction - 0.75) &lt; 0.01) {</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>                pt += (0.1721 - 0.0004 * t) * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(m))</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>                    + 0.0021 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(2 * m))</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>                    - 0.6280 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(mprime))</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>                    + 0.0089 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(2 * mprime))</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>                    - 0.0004 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(3 * mprime))</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>                    + 0.0079 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(2 * f))</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>                    - 0.0119 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(m + mprime))</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>                    - 0.0047 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(m - mprime))</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>                    + 0.0003 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(2 * f + m))</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>                    - 0.0004 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(2 * f - m))</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>                    - 0.0006 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(2 * f + mprime))</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>                    + 0.0021 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(2 * f - mprime))</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>                    + 0.0003 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(m + 2 * mprime))</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>                + 0.0004 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(m - 2 * mprime))</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>                - 0.0003 * std::sin(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(2 * m + mprime));</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span> </div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>                <span class="keywordflow">if</span> (phase_fraction &lt; 0.5) {</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>                    pt += 0.0028 - 0.0004 * std::cos(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(m)) + 0.0003 * std::cos(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(mprime));</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>                    pt += -0.0028 + 0.0004 * std::cos(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(m)) - 0.0003 * std::cos(<a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">deg2rad</a>(mprime));</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>                }</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>                <span class="keywordflow">return</span> pt;</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>            }</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span> </div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>            <span class="comment">// Fallback: return uncorrected estimate</span></div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>            <span class="keywordflow">return</span> pt;</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>        }</div>
</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span> </div>
<div class="foldopen" id="foldopen00389" data-start="{" data-end="}">
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno"><a class="line" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a267e3e5f3d326a6f875ab807ba7552ca">  389</a></span>        <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a267e3e5f3d326a6f875ab807ba7552ca">is_within_window</a>(<span class="keywordtype">double</span> unix_utc_s, <span class="keywordtype">double</span> previous_instant, <span class="keywordtype">double</span> next_instant, <span class="keywordtype">double</span> window_seconds) <span class="keyword">noexcept</span> {</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> prev_delta = std::abs(unix_utc_s - previous_instant);</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> next_delta = std::abs(unix_utc_s - next_instant);</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>            <span class="keywordflow">return</span> (prev_delta &lt;= window_seconds) || (next_delta &lt;= window_seconds);</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>        }</div>
</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>    };</div>
</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span> </div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>} <span class="comment">// namespace astronomy</span></div>
</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span></div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno"><a class="line" href="namespacetime__shield.html#a3c072257643f0594da544d5c2609f22a">  399</a></span>    <span class="keyword">using </span><a class="code hl_typedef" href="namespacetime__shield.html#a3c072257643f0594da544d5c2609f22a">MoonPhaseCalculator</a> = <a class="code hl_class" href="classtime__shield_1_1astronomy_1_1MoonPhase.html">astronomy::MoonPhase</a>;</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span> </div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>} <span class="comment">// namespace time_shield</span></div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span> </div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span><span class="preprocessor">#endif </span><span class="comment">// _TIME_SHIELD_MOON_PHASE_HPP_INCLUDED</span></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html">time_shield::astronomy::MoonPhase</a></div><div class="ttdoc">Moon phase calculator (geocentric approximation).</div><div class="ttdef"><b>Definition</b> <a href="#l00068">MoonPhase.hpp:68</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a0dadf0452c83ed1d4c3b25a045b3b528"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a0dadf0452c83ed1d4c3b25a045b3b528">time_shield::astronomy::MoonPhase::kMInc</a></div><div class="ttdeci">static constexpr double kMInc</div><div class="ttdef"><b>Definition</b> <a href="#l00284">MoonPhase.hpp:284</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a1149b5dacf88afce4526fca7d6c2204f"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a1149b5dacf88afce4526fca7d6c2204f">time_shield::astronomy::MoonPhase::kSynMonth</a></div><div class="ttdeci">static constexpr double kSynMonth</div><div class="ttdef"><b>Definition</b> <a href="#l00289">MoonPhase.hpp:289</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a1200e60d09e8c6c3e1a4a4bce66db93e"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a1200e60d09e8c6c3e1a4a4bce66db93e">time_shield::astronomy::MoonPhase::is_new_moon_window</a></div><div class="ttdeci">bool is_new_moon_window(double unix_utc_s, double window_seconds=kDefaultQuarterWindow_s) const noexcept</div><div class="ttdoc">Check whether timestamp is inside a window around new moon.</div><div class="ttdef"><b>Definition</b> <a href="#l00223">MoonPhase.hpp:223</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a1a522c5b8d60030b12ffbaaf4d760873"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a1a522c5b8d60030b12ffbaaf4d760873">time_shield::astronomy::MoonPhase::mean_phase_jd</a></div><div class="ttdeci">double mean_phase_jd(double julian_day, double lunation_index) const noexcept</div><div class="ttdef"><b>Definition</b> <a href="#l00314">MoonPhase.hpp:314</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a23981d3f5955b843b4e533fac4278428"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a23981d3f5955b843b4e533fac4278428">time_shield::astronomy::MoonPhase::kMNode</a></div><div class="ttdeci">static constexpr double kMNode</div><div class="ttdef"><b>Definition</b> <a href="#l00283">MoonPhase.hpp:283</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a25530dee9254fab236da31360b6e009b"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a25530dee9254fab236da31360b6e009b">time_shield::astronomy::MoonPhase::kMmLong</a></div><div class="ttdeci">static constexpr double kMmLong</div><div class="ttdef"><b>Definition</b> <a href="#l00281">MoonPhase.hpp:281</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a267e3e5f3d326a6f875ab807ba7552ca"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a267e3e5f3d326a6f875ab807ba7552ca">time_shield::astronomy::MoonPhase::is_within_window</a></div><div class="ttdeci">static bool is_within_window(double unix_utc_s, double previous_instant, double next_instant, double window_seconds) noexcept</div><div class="ttdef"><b>Definition</b> <a href="#l00389">MoonPhase.hpp:389</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a30b8cb4954ccbe0fb64582538145f86d"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a30b8cb4954ccbe0fb64582538145f86d">time_shield::astronomy::MoonPhase::kSunSmax</a></div><div class="ttdeci">static constexpr double kSunSmax</div><div class="ttdef"><b>Definition</b> <a href="#l00278">MoonPhase.hpp:278</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a3aa8aa8604c348634e20ab4a2c44fd1b"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a3aa8aa8604c348634e20ab4a2c44fd1b">time_shield::astronomy::MoonPhase::kElongp</a></div><div class="ttdeci">static constexpr double kElongp</div><div class="ttdef"><b>Definition</b> <a href="#l00276">MoonPhase.hpp:276</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a44c3905d162ed09fcb8bb608503659e1"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a44c3905d162ed09fcb8bb608503659e1">time_shield::astronomy::MoonPhase::kPi</a></div><div class="ttdeci">static constexpr double kPi</div><div class="ttdef"><b>Definition</b> <a href="#l00291">MoonPhase.hpp:291</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a4a7e8bae14e8b7a60204d48e2ab16d34"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a4a7e8bae14e8b7a60204d48e2ab16d34">time_shield::astronomy::MoonPhase::is_first_quarter_window</a></div><div class="ttdeci">bool is_first_quarter_window(double unix_utc_s, double window_seconds=kDefaultQuarterWindow_s) const noexcept</div><div class="ttdoc">Check whether timestamp is inside a window around first quarter.</div><div class="ttdef"><b>Definition</b> <a href="#l00241">MoonPhase.hpp:241</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a4ca8d9485791b7f880418b33575fe4f8"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a4ca8d9485791b7f880418b33575fe4f8">time_shield::astronomy::MoonPhase::julian_day_from_unix_seconds</a></div><div class="ttdeci">static double julian_day_from_unix_seconds(double unix_utc_s) noexcept</div><div class="ttdef"><b>Definition</b> <a href="#l00256">MoonPhase.hpp:256</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a510f2cd6268d99dd1a99f391893beedf"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a510f2cd6268d99dd1a99f391893beedf">time_shield::astronomy::MoonPhase::compute</a></div><div class="ttdeci">MoonPhaseResult compute(double unix_utc_s) const noexcept</div><div class="ttdoc">Compute full set of Moon phase parameters for given UTC timestamp.</div><div class="ttdef"><b>Definition</b> <a href="#l00076">MoonPhase.hpp:76</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a58824eb63383bdd9353f33c860f60a47"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a58824eb63383bdd9353f33c860f60a47">time_shield::astronomy::MoonPhase::kElonge</a></div><div class="ttdeci">static constexpr double kElonge</div><div class="ttdef"><b>Definition</b> <a href="#l00275">MoonPhase.hpp:275</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a596b898f56948e52343ffa94aa547d19"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a596b898f56948e52343ffa94aa547d19">time_shield::astronomy::MoonPhase::quarter_instants_unix</a></div><div class="ttdeci">MoonQuarterInstants quarter_instants_unix(double unix_utc_s) const noexcept</div><div class="ttdoc">Quarter instants around the provided timestamp as a structured result (Unix UTC seconds).</div><div class="ttdef"><b>Definition</b> <a href="#l00205">MoonPhase.hpp:205</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a644a32493c3059111bf2e59ba95c0a4a"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a644a32493c3059111bf2e59ba95c0a4a">time_shield::astronomy::MoonPhase::kMsMax</a></div><div class="ttdeci">static constexpr double kMsMax</div><div class="ttdef"><b>Definition</b> <a href="#l00287">MoonPhase.hpp:287</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a660dc67f4d519cd1a637a51c3b3a37f8"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a660dc67f4d519cd1a637a51c3b3a37f8">time_shield::astronomy::MoonPhase::kMmLongp</a></div><div class="ttdeci">static constexpr double kMmLongp</div><div class="ttdef"><b>Definition</b> <a href="#l00282">MoonPhase.hpp:282</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a6a30cb01a518020c1c03b8db1d93dd64"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a6a30cb01a518020c1c03b8db1d93dd64">time_shield::astronomy::MoonPhase::jd_to_unix_seconds</a></div><div class="ttdeci">static double jd_to_unix_seconds(double julian_day) noexcept</div><div class="ttdef"><b>Definition</b> <a href="#l00268">MoonPhase.hpp:268</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a70fa6a64f283459165c67a92fd508265"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a70fa6a64f283459165c67a92fd508265">time_shield::astronomy::MoonPhase::kEccent</a></div><div class="ttdeci">static constexpr double kEccent</div><div class="ttdef"><b>Definition</b> <a href="#l00277">MoonPhase.hpp:277</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a84e68b0e7b5aec034f887eb28bdaaae1"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a84e68b0e7b5aec034f887eb28bdaaae1">time_shield::astronomy::MoonPhase::kMParallax</a></div><div class="ttdeci">static constexpr double kMParallax</div><div class="ttdef"><b>Definition</b> <a href="#l00288">MoonPhase.hpp:288</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a85cf6d6f58cfc24c6176b5d963f64f25"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a85cf6d6f58cfc24c6176b5d963f64f25">time_shield::astronomy::MoonPhase::quarter_times</a></div><div class="ttdeci">quarters_unix_s_t quarter_times(double unix_utc_s) const noexcept</div><div class="ttdoc">Compatibility wrapper returning quarter instants as Unix UTC seconds.</div><div class="ttdef"><b>Definition</b> <a href="#l00198">MoonPhase.hpp:198</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a8ac97be03c5d31fb2fa832a1ee17ed38"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8ac97be03c5d31fb2fa832a1ee17ed38">time_shield::astronomy::MoonPhase::quarter_times_unix</a></div><div class="ttdeci">quarters_unix_s_t quarter_times_unix(double unix_utc_s) const noexcept</div><div class="ttdoc">Compute quarter/new/full instants around given timestamp.</div><div class="ttdef"><b>Definition</b> <a href="#l00145">MoonPhase.hpp:145</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a8d29495d3fac6f768ebe1d0c6f9494d6"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d29495d3fac6f768ebe1d0c6f9494d6">time_shield::astronomy::MoonPhase::fix_angle</a></div><div class="ttdeci">static double fix_angle(double a) noexcept</div><div class="ttdef"><b>Definition</b> <a href="#l00296">MoonPhase.hpp:296</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a8d3bd175ba3b49a3998efae951169e3a"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d3bd175ba3b49a3998efae951169e3a">time_shield::astronomy::MoonPhase::kMecc</a></div><div class="ttdeci">static constexpr double kMecc</div><div class="ttdef"><b>Definition</b> <a href="#l00285">MoonPhase.hpp:285</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a8d4be9a42d333a53d54972970f81e0fc"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a8d4be9a42d333a53d54972970f81e0fc">time_shield::astronomy::MoonPhase::rad2deg</a></div><div class="ttdeci">static double rad2deg(double rad) noexcept</div><div class="ttdef"><b>Definition</b> <a href="#l00294">MoonPhase.hpp:294</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a95bdc8ef4de8e54a4d91d226a8d6b31b"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a95bdc8ef4de8e54a4d91d226a8d6b31b">time_shield::astronomy::MoonPhase::compute_phase</a></div><div class="ttdeci">double compute_phase(double unix_utc_s) const noexcept</div><div class="ttdoc">Compute only phase fraction in [0..1) for given UTC timestamp.</div><div class="ttdef"><b>Definition</b> <a href="#l00138">MoonPhase.hpp:138</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_a9e5093e5d7e0f613eabae913f8c83c2a"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#a9e5093e5d7e0f613eabae913f8c83c2a">time_shield::astronomy::MoonPhase::quarters_unix_s_t</a></div><div class="ttdeci">std::array&lt; double, 8 &gt; quarters_unix_s_t</div><div class="ttdoc">Quarter instants as Unix UTC seconds ({new, firstQ, full, lastQ} for previous and next cycles).</div><div class="ttdef"><b>Definition</b> <a href="#l00070">MoonPhase.hpp:70</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_aa270b6a93c75ce99c1271b36ca422aad"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aa270b6a93c75ce99c1271b36ca422aad">time_shield::astronomy::MoonPhase::deg2rad</a></div><div class="ttdeci">static double deg2rad(double deg) noexcept</div><div class="ttdef"><b>Definition</b> <a href="#l00293">MoonPhase.hpp:293</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_ab0327bbd5a359bc046f92ed2b94bae54"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ab0327bbd5a359bc046f92ed2b94bae54">time_shield::astronomy::MoonPhase::kDefaultQuarterWindow_s</a></div><div class="ttdeci">static constexpr double kDefaultQuarterWindow_s</div><div class="ttdoc">Default window around phase events (12h).</div><div class="ttdef"><b>Definition</b> <a href="#l00071">MoonPhase.hpp:71</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_ab3d9eaaf9491eb4d62f9d26350cbdb22"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ab3d9eaaf9491eb4d62f9d26350cbdb22">time_shield::astronomy::MoonPhase::kepler</a></div><div class="ttdeci">static double kepler(double m_deg, double ecc) noexcept</div><div class="ttdef"><b>Definition</b> <a href="#l00302">MoonPhase.hpp:302</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_ab68f9bf10252c729eb15398425adbf6e"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ab68f9bf10252c729eb15398425adbf6e">time_shield::astronomy::MoonPhase::kMAngSiz</a></div><div class="ttdeci">static constexpr double kMAngSiz</div><div class="ttdef"><b>Definition</b> <a href="#l00286">MoonPhase.hpp:286</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_ac78daeeb9218e164893b03fdf6d78beb"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ac78daeeb9218e164893b03fdf6d78beb">time_shield::astronomy::MoonPhase::month_from_unix_seconds</a></div><div class="ttdeci">static int month_from_unix_seconds(double unix_utc_s) noexcept</div><div class="ttdef"><b>Definition</b> <a href="#l00264">MoonPhase.hpp:264</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_ada6d22fcf95905617e00ab6402e40361"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#ada6d22fcf95905617e00ab6402e40361">time_shield::astronomy::MoonPhase::year_from_unix_seconds</a></div><div class="ttdeci">static int year_from_unix_seconds(double unix_utc_s) noexcept</div><div class="ttdef"><b>Definition</b> <a href="#l00260">MoonPhase.hpp:260</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_adcf38c065a3433b94d56a2de617973a7"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#adcf38c065a3433b94d56a2de617973a7">time_shield::astronomy::MoonPhase::kSunAngSiz</a></div><div class="ttdeci">static constexpr double kSunAngSiz</div><div class="ttdef"><b>Definition</b> <a href="#l00279">MoonPhase.hpp:279</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_aee14e4c2513dcc7f4146d8f1fb7715ed"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#aee14e4c2513dcc7f4146d8f1fb7715ed">time_shield::astronomy::MoonPhase::kEpochJd</a></div><div class="ttdeci">static constexpr double kEpochJd</div><div class="ttdef"><b>Definition</b> <a href="#l00273">MoonPhase.hpp:273</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_af088de31fdc1edadfb2d0f5631e57782"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#af088de31fdc1edadfb2d0f5631e57782">time_shield::astronomy::MoonPhase::is_last_quarter_window</a></div><div class="ttdeci">bool is_last_quarter_window(double unix_utc_s, double window_seconds=kDefaultQuarterWindow_s) const noexcept</div><div class="ttdoc">Check whether timestamp is inside a window around last quarter.</div><div class="ttdef"><b>Definition</b> <a href="#l00250">MoonPhase.hpp:250</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_af2516e7561063f516f966111b70ac810"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#af2516e7561063f516f966111b70ac810">time_shield::astronomy::MoonPhase::is_full_moon_window</a></div><div class="ttdeci">bool is_full_moon_window(double unix_utc_s, double window_seconds=kDefaultQuarterWindow_s) const noexcept</div><div class="ttdoc">Check whether timestamp is inside a window around full moon.</div><div class="ttdef"><b>Definition</b> <a href="#l00232">MoonPhase.hpp:232</a></div></div>
<div class="ttc" id="aclasstime__shield_1_1astronomy_1_1MoonPhase_html_af8af02d0a8697ac2d40b6b40190f7fa9"><div class="ttname"><a href="classtime__shield_1_1astronomy_1_1MoonPhase.html#af8af02d0a8697ac2d40b6b40190f7fa9">time_shield::astronomy::MoonPhase::true_phase_jd</a></div><div class="ttdeci">double true_phase_jd(double lunation_index, double phase_fraction) const noexcept</div><div class="ttdef"><b>Definition</b> <a href="#l00325">MoonPhase.hpp:325</a></div></div>
<div class="ttc" id="adate__time__conversions_8hpp_html"><div class="ttname"><a href="date__time__conversions_8hpp.html">date_time_conversions.hpp</a></div><div class="ttdoc">Conversions involving DateTimeStruct and day boundary helpers.</div></div>
<div class="ttc" id="agroup__time__conversions_html_gae79100051ffcecb99ee8051e76133fac"><div class="ttname"><a href="group__time__conversions.html#gae79100051ffcecb99ee8051e76133fac">time_shield::year_of</a></div><div class="ttdeci">TIME_SHIELD_CONSTEXPR T year_of(ts_t ts=time_shield::ts())</div><div class="ttdoc">Get the year from the timestamp.</div><div class="ttdef"><b>Definition</b> <a href="date__conversions_8hpp_source.html#l00028">date_conversions.hpp:28</a></div></div>
<div class="ttc" id="agroup__time__structures_html_ga2673575f5f1962b618dbdf1a1c596914"><div class="ttname"><a href="group__time__structures.html#ga2673575f5f1962b618dbdf1a1c596914">time_shield::month_of_year</a></div><div class="ttdeci">TIME_SHIELD_CONSTEXPR T month_of_year(ts_t ts) noexcept</div><div class="ttdoc">Get the month of the year.</div><div class="ttdef"><b>Definition</b> <a href="date__time__conversions_8hpp_source.html#l00724">date_time_conversions.hpp:724</a></div></div>
<div class="ttc" id="agroup__time__types_html_ga183c70b9c541a395d47690a82cdad282"><div class="ttname"><a href="group__time__types.html#ga183c70b9c541a395d47690a82cdad282">time_shield::ts_t</a></div><div class="ttdeci">int64_t ts_t</div><div class="ttdoc">Unix timestamp in seconds since 19700101T00:00:00Z.</div><div class="ttdef"><b>Definition</b> <a href="types_8hpp_source.html#l00046">types.hpp:46</a></div></div>
<div class="ttc" id="anamespacetime__shield_1_1astronomy_html"><div class="ttname"><a href="namespacetime__shield_1_1astronomy.html">time_shield::astronomy</a></div><div class="ttdef"><b>Definition</b> <a href="#l00019">MoonPhase.hpp:19</a></div></div>
<div class="ttc" id="anamespacetime__shield_html"><div class="ttname"><a href="namespacetime__shield.html">time_shield</a></div><div class="ttdoc">Main namespace for the Time Shield library.</div></div>
<div class="ttc" id="anamespacetime__shield_html_a3c072257643f0594da544d5c2609f22a"><div class="ttname"><a href="namespacetime__shield.html#a3c072257643f0594da544d5c2609f22a">time_shield::MoonPhaseCalculator</a></div><div class="ttdeci">astronomy::MoonPhase MoonPhaseCalculator</div><div class="ttdoc">Convenience alias for the geocentric Moon phase calculator.</div><div class="ttdef"><b>Definition</b> <a href="#l00399">MoonPhase.hpp:399</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonPhaseResult_html"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html">time_shield::astronomy::MoonPhaseResult</a></div><div class="ttdoc">Result of Moon phase computation (geocentric approximation).</div><div class="ttdef"><b>Definition</b> <a href="#l00022">MoonPhase.hpp:22</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonPhaseResult_html_a152397a580e31c179e4a327a6e57d0dc"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#a152397a580e31c179e4a327a6e57d0dc">time_shield::astronomy::MoonPhaseResult::sun_distance_km</a></div><div class="ttdeci">double sun_distance_km</div><div class="ttdef"><b>Definition</b> <a href="#l00032">MoonPhase.hpp:32</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonPhaseResult_html_a293f0368555bf2e39ec792c672dd231c"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#a293f0368555bf2e39ec792c672dd231c">time_shield::astronomy::MoonPhaseResult::age_deg</a></div><div class="ttdeci">double age_deg</div><div class="ttdoc">Phase angle in degrees (0..360).</div><div class="ttdef"><b>Definition</b> <a href="#l00028">MoonPhase.hpp:28</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonPhaseResult_html_a33799b14b055d6c8e0e38360b52df878"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#a33799b14b055d6c8e0e38360b52df878">time_shield::astronomy::MoonPhaseResult::distance_km</a></div><div class="ttdeci">double distance_km</div><div class="ttdoc">Distance to Moon in km (approx).</div><div class="ttdef"><b>Definition</b> <a href="#l00026">MoonPhase.hpp:26</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonPhaseResult_html_a7b675de383072b1bedebe3bf0159bbad"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#a7b675de383072b1bedebe3bf0159bbad">time_shield::astronomy::MoonPhaseResult::diameter_deg</a></div><div class="ttdeci">double diameter_deg</div><div class="ttdoc">Angular diameter of Moon in degrees (approx).</div><div class="ttdef"><b>Definition</b> <a href="#l00027">MoonPhase.hpp:27</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonPhaseResult_html_a8951e27fdb33eee9dd28d4728d634eb8"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#a8951e27fdb33eee9dd28d4728d634eb8">time_shield::astronomy::MoonPhaseResult::phase</a></div><div class="ttdeci">double phase</div><div class="ttdoc">Phase fraction in [0..1). 0=new moon, 0.5=full moon.</div><div class="ttdef"><b>Definition</b> <a href="#l00023">MoonPhase.hpp:23</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonPhaseResult_html_aa5e113195cdff17210b79cf78a87fc35"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#aa5e113195cdff17210b79cf78a87fc35">time_shield::astronomy::MoonPhaseResult::phase_sin</a></div><div class="ttdeci">double phase_sin</div><div class="ttdoc">sin(phase_angle_rad) helper for continuous signal.</div><div class="ttdef"><b>Definition</b> <a href="#l00030">MoonPhase.hpp:30</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonPhaseResult_html_aab77c808b2b2bd104293bd7808156bd6"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#aab77c808b2b2bd104293bd7808156bd6">time_shield::astronomy::MoonPhaseResult::phase_angle_rad</a></div><div class="ttdeci">double phase_angle_rad</div><div class="ttdoc">Phase angle in radians (0..2*pi).</div><div class="ttdef"><b>Definition</b> <a href="#l00029">MoonPhase.hpp:29</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonPhaseResult_html_ab228bffaa62de41e0808ea069dd2363a"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#ab228bffaa62de41e0808ea069dd2363a">time_shield::astronomy::MoonPhaseResult::age_days</a></div><div class="ttdeci">double age_days</div><div class="ttdoc">Age of the Moon in days since new moon (approx).</div><div class="ttdef"><b>Definition</b> <a href="#l00025">MoonPhase.hpp:25</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonPhaseResult_html_ab8d76a7d973ff539b60d7a0aaf5c4671"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#ab8d76a7d973ff539b60d7a0aaf5c4671">time_shield::astronomy::MoonPhaseResult::phase_cos</a></div><div class="ttdeci">double phase_cos</div><div class="ttdoc">cos(phase_angle_rad) helper for continuous signal.</div><div class="ttdef"><b>Definition</b> <a href="#l00031">MoonPhase.hpp:31</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonPhaseResult_html_ae253f47c5b67846a3f274cecf527e65f"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#ae253f47c5b67846a3f274cecf527e65f">time_shield::astronomy::MoonPhaseResult::illumination</a></div><div class="ttdeci">double illumination</div><div class="ttdoc">Illuminated fraction in [0..1].</div><div class="ttdef"><b>Definition</b> <a href="#l00024">MoonPhase.hpp:24</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonPhaseResult_html_aefe0063683948d45ee44e7a97746e4b6"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonPhaseResult.html#aefe0063683948d45ee44e7a97746e4b6">time_shield::astronomy::MoonPhaseResult::sun_diameter_deg</a></div><div class="ttdeci">double sun_diameter_deg</div><div class="ttdef"><b>Definition</b> <a href="#l00033">MoonPhase.hpp:33</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonQuarterInstants_html"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html">time_shield::astronomy::MoonQuarterInstants</a></div><div class="ttdoc">Lunar quarter instants (Unix UTC seconds, floating).</div><div class="ttdef"><b>Definition</b> <a href="#l00037">MoonPhase.hpp:37</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonQuarterInstants_html_a356edba6d87834d2b899c9cd62b0ad7c"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#a356edba6d87834d2b899c9cd62b0ad7c">time_shield::astronomy::MoonQuarterInstants::previous_new_unix_s</a></div><div class="ttdeci">double previous_new_unix_s</div><div class="ttdoc">Previous new moon instant (Unix UTC seconds, double).</div><div class="ttdef"><b>Definition</b> <a href="#l00038">MoonPhase.hpp:38</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonQuarterInstants_html_a42529ef6435ba9498a9d0084e2a861a9"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#a42529ef6435ba9498a9d0084e2a861a9">time_shield::astronomy::MoonQuarterInstants::previous_first_quarter_unix_s</a></div><div class="ttdeci">double previous_first_quarter_unix_s</div><div class="ttdoc">Previous first quarter instant (Unix UTC seconds, double).</div><div class="ttdef"><b>Definition</b> <a href="#l00039">MoonPhase.hpp:39</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonQuarterInstants_html_a4dae0578645fabc81a9fd1afb07800ec"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#a4dae0578645fabc81a9fd1afb07800ec">time_shield::astronomy::MoonQuarterInstants::previous_full_unix_s</a></div><div class="ttdeci">double previous_full_unix_s</div><div class="ttdoc">Previous full moon instant (Unix UTC seconds, double).</div><div class="ttdef"><b>Definition</b> <a href="#l00040">MoonPhase.hpp:40</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonQuarterInstants_html_a5708c19ab02832b8feb1995fc973e1dc"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#a5708c19ab02832b8feb1995fc973e1dc">time_shield::astronomy::MoonQuarterInstants::next_last_quarter_unix_s</a></div><div class="ttdeci">double next_last_quarter_unix_s</div><div class="ttdoc">Next last quarter instant (Unix UTC seconds, double).</div><div class="ttdef"><b>Definition</b> <a href="#l00045">MoonPhase.hpp:45</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonQuarterInstants_html_a74179e2125a2eef0a9f2a7d3f43f2d45"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#a74179e2125a2eef0a9f2a7d3f43f2d45">time_shield::astronomy::MoonQuarterInstants::next_new_unix_s</a></div><div class="ttdeci">double next_new_unix_s</div><div class="ttdoc">Next new moon instant (Unix UTC seconds, double).</div><div class="ttdef"><b>Definition</b> <a href="#l00042">MoonPhase.hpp:42</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonQuarterInstants_html_ab7d1206dfddf7dca7c9d837d49049daa"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#ab7d1206dfddf7dca7c9d837d49049daa">time_shield::astronomy::MoonQuarterInstants::previous_last_quarter_unix_s</a></div><div class="ttdeci">double previous_last_quarter_unix_s</div><div class="ttdoc">Previous last quarter instant (Unix UTC seconds, double).</div><div class="ttdef"><b>Definition</b> <a href="#l00041">MoonPhase.hpp:41</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonQuarterInstants_html_ae7de2c2e6e5ce88a993f0ca7f9428223"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#ae7de2c2e6e5ce88a993f0ca7f9428223">time_shield::astronomy::MoonQuarterInstants::next_first_quarter_unix_s</a></div><div class="ttdeci">double next_first_quarter_unix_s</div><div class="ttdoc">Next first quarter instant (Unix UTC seconds, double).</div><div class="ttdef"><b>Definition</b> <a href="#l00043">MoonPhase.hpp:43</a></div></div>
<div class="ttc" id="astructtime__shield_1_1astronomy_1_1MoonQuarterInstants_html_af08745ad437f9b22a8d2811b50383460"><div class="ttname"><a href="structtime__shield_1_1astronomy_1_1MoonQuarterInstants.html#af08745ad437f9b22a8d2811b50383460">time_shield::astronomy::MoonQuarterInstants::next_full_unix_s</a></div><div class="ttdeci">double next_full_unix_s</div><div class="ttdoc">Next full moon instant (Unix UTC seconds, double).</div><div class="ttdef"><b>Definition</b> <a href="#l00044">MoonPhase.hpp:44</a></div></div>
<div class="ttc" id="atypes_8hpp_html"><div class="ttname"><a href="types_8hpp.html">types.hpp</a></div><div class="ttdoc">Type definitions for time-related units and formats.</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_07c7b06f5dd7d1513dc7d4081673a960.html">time_shield</a></li><li class="navelem"><a class="el" href="MoonPhase_8hpp.html">MoonPhase.hpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
